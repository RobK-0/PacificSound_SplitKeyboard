# PacificSound_SplitKeyboard
Custom Column Stagger Split Keyboard

This keyboard is an initial attempt at making a custom ergonomic column stagger split keyboard. It was the result of wanting to design a column stagger keyboard that operated using the STM32F4XX development boards (BlackPill). The generation of the PCB contained here was a result of a PCB promotion that offered free prototypes so long as they fit within 150mm X 100mm so I rearranged things to fit in. I also wanted to be sure I could make use of the SPI capability on these boards to (theoretically) be able to maximize data transfer between the halves limit latency. The plan is also to explore the use of DMA for fast transfers and RTOS for scheduling. Due to the use of SPI the boards are _not compatible with QMK_.

# Mistakes Were Made
The first mistake made was the use of pin B2. Although I was not planning on having compatibility with QMK, I initially used QMK on one half to test it for any issues. I discovered that the use of pin B2 as a row pin caused QMK to trigger all keys in a column whenever a key connected to that row was pressed. I checked a breadboard setup with a single key attached and it gave the same issue. The issue was consistent accross several MCUs so I concluded it was an issue with using pin B2 as a row pin with column to row diodes. B2 is a board hardware pin for booting and, as such, it has an pulldown resistor on the BlackPill. My guess is that this pulldown resistor causes problems. The issue is easily fixed in the firmware I have written. The rows are used as output lines and the columns are used as input lines. The columns are set in the code to have the internal pull-up resistors enabled so that they all normally sense high. The rows are all normally set to high. Then during the matrix sweep the rows are sequentially pulled low and the columns are read to detect any low signals (a pressed switch will pull the column line low). But if I were updating the design I would not use pin B2 as a row line since it is not necessary as there are other pins available.

The next issue I discovered was with the ethernet jack (RJ45). In my efforts to squeeze into the free prototype space I moved the jack inboard and rotated it. The orientation of the jack means that the locking tab on the cable is up against the PCB and is not accessible to depress for removal of the cable. In order to remove a cable something must be slid between the locking tab and the PCB and then lifted up (eg a guitar pick). If I were updating this design I would either move the jack over to the edge (likely requires widening the PCB) or do an edge cut up to the face of the jack. Presently the traces from the ethernet jack run directly along where the cable comes in so they would need to be rerouted even if just the additional cutaway was added.

The last update I would do (that I know of at the moment) is I would connect the USART TX and RX as I've heard that people have gotten that working in QMK (although I didn't have much luck with it when I tried). This, along with fixing the B2 pin issue, should open it up for use with QMK. There are 8 conductors in the RJ45 jack. I wanted SPI communication (needs 3 lines although I hooked up the NSS line even though it's not needed) and power and ground are, of course, required. I doubled up on power and ground lines but, if I hadn't done that, there would have been spare lines in the ethernet cable.
